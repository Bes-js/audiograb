import { spawn } from 'child_process';
import b from '@ffmpeg-installer/ffmpeg';
import O from 'os';
import { EventEmitter } from 'events';

/* Package */
var l=Object.defineProperty;var a=(f,e)=>l(f,"name",{value:e,configurable:!0});var R=(r=>(r.RecordStarted="recordStarted",r.RecordStopped="recordStopped",r.RecordPaused="recordPaused",r.RecordResumed="recordResumed",r.FFmpegInformation="ffmpegInformation",r.AudioData="audioData",r))(R||{}),t=class t extends EventEmitter{constructor(e={$debug:!1}){super(),this.ffmpeg=null,this.recorderOptions=e,this.recording=!1,this.paused=!1;}setFormat(e){return this.recorderOptions["-f"]=e,this}setAudioCodec(e){return this.recorderOptions["-c:a"]=e,this}setBitrate(e){return this.recorderOptions["-b:a"]=e,this}setInputDevice(e){return this.recorderOptions["-i"]=e,this}setOutputFormat(e){return this.recorderOptions["-of"]=e,this}setFfmpegPath(e){return this.recorderOptions.ffmpegPath=e,this}start(){var o,n,d;if(this.recording&&this.recorderOptions.$debug){console.log("Recording is already in progress.");return}this.emit("recordStarted");let e=O.platform(),p=this.recorderOptions["-f"]?this.recorderOptions["-f"]:e==="win32"?"dshow":e==="darwin"?"avfoundation":"alsa",c=this.recorderOptions["-of"]?this.recorderOptions["-of"]:"mp3",g=this.recorderOptions["-c:a"]?this.recorderOptions["-c:a"]:"libmp3lame",h=this.recorderOptions["-b:a"]?this.recorderOptions["-b:a"]:"128k",r=this.recorderOptions["-i"]?this.recorderOptions["-i"]:e==="win32"?"Microphone":e==="darwin"?":0":e==="linux"?"default":"Microphone",u=this.recorderOptions.ffmpegPath?this.recorderOptions.ffmpegPath:b.path;this.ffmpeg=spawn(u,["-f",p,"-i",`audio=${r}`,"-c:a",g,"-b:a",h,"-f",c,"pipe:1"]),(o=this.ffmpeg.stdout)==null||o.on("data",i=>{this.emit("audioData",i);}),this.recording=!0,(n=this.ffmpeg.stderr)==null||n.on("data",i=>{this.emit("ffmpegInformation",i.toString());}),(d=this.ffmpeg.stdin)==null||d.on("error",i=>{this.emit("ffmpegInformation",i.message);}),this.ffmpeg.on("error",i=>{this.emit("ffmpegInformation",i.message);}),this.ffmpeg.on("close",()=>{this.emit("recordStopped"),this.recording=!1,this.paused=!1;});}stop(){this.recording?this.ffmpeg&&(this.ffmpeg.kill("SIGINT"),this.recording=!1,this.paused=!1,this.recorderOptions.$debug&&console.log("Recording stopped.")):this.recorderOptions.$debug&&console.log("No recording is in progress.");}pause(){this.recording&&!this.paused?this.ffmpeg&&(this.ffmpeg.kill("SIGSTOP"),this.paused=!0,this.emit("recordPaused",this.paused),this.recorderOptions.$debug&&console.log("Recording paused.")):this.paused?this.recorderOptions.$debug&&console.log("Recording is already paused."):this.recorderOptions.$debug&&console.log("No recording is in progress.");}resume(){this.recording&&this.paused?this.ffmpeg&&(this.ffmpeg.kill("SIGCONT"),this.paused=!1,this.emit("recordResumed",this.paused),this.recorderOptions.$debug&&console.log("Recording resumed.")):this.paused?this.recorderOptions.$debug&&console.log("No recording is in progress."):this.recorderOptions.$debug&&console.log("Recording is not paused.");}};a(t,"Recorder");var s=t;/* Package */

export { R as EventType, s as default };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=recorder.mjs.map